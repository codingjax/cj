(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[471],{1763:function(e,t,s){var o=s(4239),r=s(7005);e.exports=function(e){return"number"==typeof e||r(e)&&"[object Number]"==o(e)}},471:function(e,t,s){"use strict";s.r(t),s.d(t,{OAuth:function(){return h}});s(4301);var o=s(4997),r=s(4293),n=s(7037),i=s(1763),a=s(2228);class h{constructor(e){this.cookies=e,this.tokenKey=`${(0,o.vc)().wpUrl}-rt`}getRefreshToken(){return this.cookies.getCookie(this.tokenKey)}setRefreshToken(e,t){n(e)&&0!==e.length||this.cookies.removeCookie(this.tokenKey);let s,o=2592e3;i(t)&&(s=new Date(1e3*t),o=void 0),this.cookies.setCookie(this.tokenKey,e,{expires:s,maxAge:o,path:"/",sameSite:"strict",secure:!0,httpOnly:!0})}async fetch(e){const{wpUrl:t,apiClientSecret:s}=(0,o.vc)();if(!s)throw new Error("The apiClientSecret must be specified to use the auth middleware");let r=await fetch(`${t}/?rest_route=/faustwp/v1/authorize`,{headers:{"Content-Type":"application/json","x-faustwp-secret":s},method:"POST",body:JSON.stringify({code:e,refreshToken:this.getRefreshToken()})});404===r.status&&(r=await fetch(`${t}/?rest_route=/wpac/v1/authorize`,{headers:{"Content-Type":"application/json","x-wpe-headless-secret":s},method:"POST",body:JSON.stringify({code:e,refreshToken:this.getRefreshToken()})}),404!==r.status&&(0,a.cM)("Authentication and post previews will soon be incompatible with your version of the FaustWP plugin. Please update to the latest version."));const n=await r.json();return r.ok?n:{error:!0,response:r,result:n}}isOAuthTokens(e){const t=e;return!r(t)&&n(t.accessToken)&&n(t.refreshToken)&&i(t.accessTokenExpiration)&&i(t.refreshTokenExpiration)}}}}]);